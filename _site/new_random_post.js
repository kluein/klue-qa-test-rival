const fs = require('fs');
const path = require('path');
const faker = require('faker');

// Generate a random alphanumeric string for the file name
function generateRandomName(length) {
  const characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let result = '';
  for (let i = 0; i < length; i++) {
    result += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  return result;
}

// Get today's date in the format 'YYYY-MM-DD HH:mm:ss Z'
function getCurrentDate() {
    const now = new Date();
    const timezoneOffset = now.getTimezoneOffset() * 60000; // Offset in milliseconds
    const timezoneOffsetHours = Math.abs(Math.floor(timezoneOffset / 3600000)).toString().padStart(2, '0');
    const timezoneOffsetMinutes = (Math.abs(Math.floor(timezoneOffset / 60000)) % 60).toString().padStart(2, '0');
    const timezoneSign = timezoneOffset < 0 ? '+' : '-';
    const timezone = `${timezoneSign}${timezoneOffsetHours}${timezoneOffsetMinutes}`;
  
    return (new Date(now - timezoneOffset)).toISOString().replace('T', ' ').replace('Z', ` ${timezone}`);
}
  
  

// Generate the content for the new HTML file
function generateContent(date, randomName) {
    const title = faker.lorem.sentence();
    const subtitle = faker.lorem.sentence();
    const postDate = getCurrentDate();
    const randomImgNumber = Math.floor(Math.random() * 6) + 1;
    const background = `/img/posts/0${randomImgNumber}.jpg`;
    const header = `---
layout: post
title: "${title}"
subtitle: "${subtitle}"
date: ${postDate}
background: '${background}'
---
  
`;
    let autogeneratedContent = '';
    for (let i = 0; i < 5; i++) {
    const paragraph = faker.lorem.paragraph();
    autogeneratedContent += `<p>${paragraph}</p>\n\n`;
    }
    return `${header.trim()}\n\n${autogeneratedContent}`;
}

// Create a new HTML file with today's date and a random name
function createNewHTMLFile() {
  const currentDate = getCurrentDate().split(' ')[0]; 
  const randomName = generateRandomName(8);
  const fileName = `${currentDate}-${randomName}.html`;
  const filePath = path.join('_posts', fileName);
  const fileContent = generateContent(currentDate, randomName);

  fs.writeFile(filePath, fileContent, (err) => {
    if (err) {
      console.error('Error creating the HTML file:', err);
    } else {
      console.log(`New HTML file created: ${filePath}`);
    }
  });
}

// Run the script
createNewHTMLFile();
